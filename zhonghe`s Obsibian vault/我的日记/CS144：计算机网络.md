
## 开始

http get command 浏览器和服务器建立连接 

服务器很少位于NAT之后 因为 互联网的任何人都可以访问它，个人电脑 一般位于NAT之后 

*万维网*

*bitTorrent*  双向字节字符串 

*skype*：

NAT 网路地址转换 

![[NAT.png]]


b 向计算计发送一条信息 表示b已经连接到该计算机  b打开了a的连接 ： 

***反向连接：*** 原本是a呼叫b打开b的连接，但是最终结果是b打开了a的连接 

**1. 问题：这个是a不在NAT之后 如果两个都位于NAT之后如何通信呢？**

第二种服务器 中继：relay

![[中继服务器.png]]


## 四层模型：

作用： 应用程序能够与终端主机进行可靠通信

数据以数据包的形式传输

#### Link： 链路层

链路层的主要任务是确保数据在物理介质上的可靠传输。

*以太网和WiFi* ：

1. 以太网：

- MAC 地址：每个设备都有一个唯一的 MAC 地址，用于标识网络中的设备。

- 广泛应用于局域网（LAN）中。 

***它提供了计算机和其他设备在局部区域内进行数据交换的方式***

- **物理介质**：以太网可以通过双绞线（如 Cat5e、Cat6）、光纤或无线（如 Wi-Fi）传输数据。

2. WiFi :

- Wi-Fi 是一种无线链路层技术，广泛应用于无线局域网（WLAN）中。
- MAC 地址：与以太网类似，Wi-Fi 设备也有唯一的 MAC 地址。
- 数据帧格式：Wi-Fi 使用特定的帧格式来封装数据，包括控制字段、地址字段和数据字段。

 **当手机向笔记本电脑发送数据时，链路层会将数据封装为 Wi-Fi 帧，并通过无线信道传输。**


#### Network: 网络层

通过互联网 端到端的 从 源到目的地传递数据包 是网络中的重要组成部分

网络层数据包：称为 **数据报**：

**报头（Header）** ：  源 IP 地址  目标 IP 地址 等
    


**数据部分（Payload）**： 包含上层协议（如 TCP、UDP）传递的数据。


***网络层将数据报交给链路层  向下传递***

![[数据报传输.png]]


另一方面 ***路由器*** 从*链路层接收数据包*并将其转交给*路由器内的网络层*

![[传输.png]]

####  ip 

尽力 将数据报传送到另一端 但是 ip 可能会无序传送并且可能损坏

所以需要在ip之上运行另一个协议  转移到

#### ***Transport 传输层***

**TCP协议**：TCP协议确保数据传输的可靠性。

**UDP协议**： 不提供任何传送保证


#### Application 应用层

应用程序 在两个端点之间 建立 双向可靠的字节流

![[总体路线.png]]

1. 向下选择 是否可靠传输-》数据包-》 链路层-》 传输-》 重新封装


***ip is the "thin waist"***

这句话强调了 IP 协议在互联网架构中的核心地位。它像沙漏的细腰一样，连接了上层的多样性和下层的多样性，实现了互联网的灵活性和可扩展性。这种设计是互联网成功的关键之一，但也带来了一些挑战，需要在未来的发展中不断改进。


---

## 网络层

IP Datagram -》 IP Data + IP Hdr  

数据报中包含 源地址和目的地址

路由器根据*转发表* 对照地址 一步步向下传递

类比 快递 一站一站传递 但是他不保证我们什么时候才能被送到

ip 丢包了也不会告诉原数据包 

ip不可靠 丢包 错误的路由表会导致到错误的目的地  或者导致数据包被错误的复制

ip是非常简单的最小服务 通信无连接 

#### 问题1：

ip的主要作用是什么？ 为什么ip要有发送数据包到目的地的能力呢？ 而且它的传递还是不可靠的

#### 回答1:

1.  **IP的主要作用**
#### **寻址（Addressing）**

IP为网络中的每个设备分配唯一的逻辑地址（IP地址），用于标识发送方和接收方

2.  **路由（Routing）**

- IP协议定义了数据包如何通过多个网络节点（如路由器）从源地址跳转到目标地址。
    
- 路由器根据IP地址和路由表决定数据包的下一跳路径。

 3. **分片与重组（Fragmentation & Reassembly）**

- 如果数据包大小超过底层网络（如以太网）的最大传输单元（MTU），IP会将其分片传输，并在目的地重组。


IP的核心设计目标是**实现跨网络的通信**，无论底层网络技术（以太网、Wi-Fi、光纤等）如何差异。它的存在解决了以下问题：

- **异构网络互联**：不同物理网络（如局域网和广域网）可能使用不同的寻址方式（如MAC地址），IP通过统一的逻辑地址（IP地址）屏蔽底层差异，实现互联。

***IP协议本身不保证数据包的可靠传输，这是其设计上的刻意选择，原因包括：***

- IP是网络层协议，专注于高效的路由和寻址。可靠性（如丢包重传、顺序纠正）由更高层协议（如TCP）负责。

这种分层设计使得IP轻量化，适应不同应用需求 ， 例如视频流可以容忍丢包，但文件传输需要可靠性
*IP的“不可靠”允许上层协议（如TCP或UDP）根据需求自行处理*

维护成本更低 数据包也会更快的到达 专门硬件加速 

***端到端原则：***

其核心观点是：


> **“某些功能（如可靠性、安全性）最好在通信的最终端点（end hosts）实现，而不是在网络中间节点（如路由器、交换机）上实现。”**

 ip可以让应用程序选择 使用可靠还是不可靠 

#### 为什么 ip服务如此简单？

![[ip server is so simple.png]]


i![[IP Model.png]]

#### 了解ipv4每个字段的作用


![[ipv4.png]]


---

环境配置

直接使用wsl



```c
root@xiaoxinxiaohao:/CS144# 

telnet cs144.keithw.org http

Trying 104.196.238.229...
Connected to cs144.keithw.org.
Escape character is '^]'.

GET /hello HTTP/1.1
Host: cs144.keithw.org
Connection: close

HTTP/1.1 200 OK
Date: Sat, 15 Mar 2025 11:32:33 GMT
Server: Apache
Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT
ETag: "e-57ce93446cb64"
Accept-Ranges: bytes
Content-Length: 14
Connection: close
Content-Type: text/plain

Hello, CS144!
Connection closed by foreign host.

```



~~~
1. **获取邮箱的 SMTP 服务器地址**：
    
    - 不同邮箱提供商的 SMTP 服务器地址不同。以下是一些常见邮箱的 SMTP 服务器：
        
        - Gmail: `smtp.gmail.com`（端口 587 或 465）
            
        - Outlook/Hotmail: `smtp.office365.com`（端口 587）
            
        - Yahoo: `smtp.mail.yahoo.com`（端口 465 或 587）
            
        - QQ 邮箱: `smtp.qq.com`（端口 465 或 587）
~~~


![[telnet.png]]


 netcat -v -l -p 9090（服务器）
 telnet localhost 9090 (客户端)


 #### *通信服务是无连接的*

**通信双方在传输数据前不需要预先建立专用连接，每个数据包（或数据报）独立传输，彼此没有依赖关系**。

 **无需预先建立连接**

- 在发送数据前，发送方和接收方**不需要握手（如TCP的三次握手）**，直接发送数据包。
    
- 例如：IP协议发送数据包时，不会先询问对方是否准备好，而是直接发出。

 **每个数据包独立处理**

- 每个数据包（如IP数据报或UDP报文）**单独寻址和路由**，即使属于同一个通信流，也可能走不同路径。
    
- 例如：发送3个数据包，可能走不同的网络路径，到达顺序也可能不同。

**不维护连接状态**

- 通信双方**不会记录对方的状态**（如TCP的序列号、窗口大小等）。
    
- 例如：IP路由器转发数据包后，不会记住这个包是谁发的，也不会确保它一定能到达。

 **不可靠性（通常）**

- 无连接协议通常不保证数据包一定能到达、按序到达或不重复（如IP和UDP）。
    
- 可靠性（如丢包重传）需要由上层协议（如TCP）或应用程序自己处理。


***省去握手过程（如TCP三次握手），减少延迟***
